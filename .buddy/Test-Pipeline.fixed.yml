- pipeline: "Test Pipeline"
  events:
  - type: "PUSH"
    refs:
    - "refs/heads/main"
  fail_on_prepare_env_warning: true
  actions:
  - action: "npx react-native run-ios --configuration Release"
    type: "NATIVE_BUILD_MAC_REACT"
    commands:
    - "npx react-native run-ios --configuration Release"
    shell: "BASH"
    pre_start_simulators:
    - "iPhone 15 Pro"
    node_version: "18"
    xcode_version: "15.4.0"
  - action: "./gradlew assembleRelease"
    type: "BUILD"
    docker_image_name: "library/openjdk"
    docker_image_tag: "17.0.2"
    execute_commands:
    - "#Install Android SDK"
    - ""
    - "#Buddy"
    - "export ANDROID_HOME=\"/opt/android/sdk/\""
    - "export PATH=$PATH:/opt/android/sdk/cmdline-tools/tools/bin"
    - "if [ ! -d \"$ANDROID_HOME/cmdline-tools\" ]; then"
    - " curl -o sdk.zip https://dl.google.com/android/repository/commandlinetools-linux-7583922_latest.zip"
    - " unzip sdk.zip"
    - " rm sdk.zip"
    - " mkdir \"$ANDROID_HOME/cmdline-tools\""
    - " mv cmdline-tools \"$ANDROID_HOME/cmdline-tools/tools\""
    - " yes | \"$ANDROID_HOME/cmdline-tools/tools/bin/sdkmanager\" --licenses"
    - "fi"
    - "#Buddy"
    - ""
    - "#build"
    - "npm install"
    - "cd ./android"
    - "chmod +x gradlew"
    - "./gradlew assembleRelease"
    setup_commands:
    - "# install nodejs"
    - "apt-get install -y ca-certificates curl gnupg"
    - "mkdir -p /etc/apt/keyrings"
    - "curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg"
    - "echo \"deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_22.x nodistro main\" | tee /etc/apt/sources.list.d/nodesource.list"
    - "apt-get update"
    - "apt-get install -y nodejs"
    cached_dirs:
    - "/root/.gradle"
    - "/opt/android/sdk"
    shell: "BASH"
